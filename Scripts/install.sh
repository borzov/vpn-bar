#!/bin/bash

# –°–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ VPN Bar
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç –∫–∞—Ä–∞–Ω—Ç–∏–Ω macOS –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

set -e

APP_NAME="VPNBarApp.app"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
APP_PATH="$SCRIPT_DIR/../$APP_NAME"
INSTALL_PATH="/Applications/$APP_NAME"

echo "üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ VPN Bar..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
if [ ! -d "$APP_PATH" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: $APP_NAME –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏"
    echo "   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã —Ä–∞—Å–ø–∞–∫–æ–≤–∞–ª–∏ –∞—Ä—Ö–∏–≤ –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ –ø–∞–ø–∫–∏ —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º"
    exit 1
fi

# –£–¥–∞–ª—è–µ–º –∫–∞—Ä–∞–Ω—Ç–∏–Ω macOS
echo "üîì –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ä–∞–Ω—Ç–∏–Ω–∞ macOS..."
xattr -dr com.apple.quarantine "$APP_PATH" 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å
if [ -d "$INSTALL_PATH" ]; then
    echo "üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏..."
    rm -rf "$INSTALL_PATH"
fi

# –ö–æ–ø–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
echo "üì¶ –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ /Applications..."
cp -R "$APP_PATH" "$INSTALL_PATH"

# –£–¥–∞–ª—è–µ–º –∫–∞—Ä–∞–Ω—Ç–∏–Ω —É —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
xattr -dr com.apple.quarantine "$INSTALL_PATH" 2>/dev/null || true

echo "‚úÖ VPN Bar —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!"
echo ""
echo "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: $INSTALL_PATH"
echo "–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –∏–∑ –ø–∞–ø–∫–∏ –ü—Ä–æ–≥—Ä–∞–º–º—ã –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:"
echo "   open $INSTALL_PATH"

